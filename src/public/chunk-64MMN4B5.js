import{b as G,c as y,d as q,e as B,g as z,h as J,i as P,j as H,k as K,l as Q,m as W,o as X}from"./chunk-I6XBKDLU.js";import{a as U}from"./chunk-4YYULNNJ.js";import{a as Y}from"./chunk-ICMS3UPS.js";import{p as j}from"./chunk-PLFFXBHS.js";import{$ as w,$a as C,Db as E,Hb as M,Ib as A,Ka as R,Kb as O,Pa as u,Y as v,bb as d,d as p,e as g,eb as t,f as h,fb as e,gb as c,gc as L,ja as I,ka as _,kb as D,lb as x,lc as k,mb as V,ub as F,vb as n,wb as T}from"./chunk-Q52YNUQE.js";var Z=(()=>{var r;let o=class o{constructor(){g(this,r,void 0);this.type="usuario",this.imagen="",h(this,r,v(U))}ngOnInit(){this.img=p(this,r).getImagen(this.type,this.imagen)}};r=new WeakMap,o.\u0275fac=function(s){return new(s||o)},o.\u0275cmp=w({type:o,selectors:[["app-view-image"]],inputs:{type:"type",imagen:"imagen"},standalone:!0,features:[E],decls:3,vars:2,consts:[[1,"card"],[1,"card-body"],[3,"src","alt"]],template:function(s,N){s&1&&(t(0,"div",0)(1,"div",1),c(2,"img",2),e()()),s&2&&(u(2),d("src",N.img,R)("alt",N.imagen))}});let i=o;return i})();function re(i,r){i&1&&(t(0,"div",8)(1,"label",23),n(2,"Correo electr\xF3nico"),e(),c(3,"input",24),e())}function ne(i,r){i&1&&(t(0,"div",8)(1,"label",25),n(2,"Rol"),e(),t(3,"select",26)(4,"option",27),n(5,"Sleccione Rol"),e(),t(6,"option",28),n(7,"Administrador"),e(),t(8,"option",29),n(9,"Usuario"),e()()())}function oe(i,r){if(i&1&&(t(0,"div"),c(1,"app-view-image",30),e()),i&2){let o=V();u(),d("imagen",o.imagen)}}function ae(i,r){i&1&&(t(0,"label",31),n(1," Selecciona archivo"),e())}var $=(()=>{var r,o,S,f;let s=class s{constructor(){g(this,r,void 0);g(this,o,void 0);g(this,S,void 0);g(this,f,void 0);h(this,r,v(j)),h(this,o,v(U)),h(this,S,v(Y)),h(this,f,v(W)),this.formUser=p(this,f).nonNullable.group({name:["",[y.required]],password:["",[y.required]],password2:["",[y.required]],role:[""],email:[""]}),this.uploadImagen=!1}ngOnInit(){this.user=p(this,r).currentUserExists().usuario,this.imagen=this.user.img?this.user.img:"",this.formUser.patchValue({name:this.user.name,role:this.user.role,email:this.user.email})}cambiarImagen(l){if(this.imagenSubir=l.target.files[0],this.uploadImagen=!0,!l.target.files[0])return this.imgTemp=null;let a=new FileReader;a.readAsDataURL(l.target.files[0]),a.onloadend=()=>{this.imgTemp=a.result||null}}saved(){if(this.formUser.markAllAsTouched(),!this.formUser.invalid&&this.formUser.getRawValue().password===this.formUser.getRawValue().password2){let l={_id:this.user._id,name:this.formUser.getRawValue().name,role:this.formUser.getRawValue().role,email:this.formUser.getRawValue().email,password:this.formUser.getRawValue().password};p(this,S).UpdateUser(l).subscribe(a=>{a.ok&&(this.resetSesionStorage(a.usuario),this.uploadImagen&&p(this,o).uploadImage(this.imagenSubir,"usuario",this.user._id).subscribe(m=>{m.ok&&(this.resetSesionStorage(m.usuario),this.imagen=m.usuario.img)}))})}}resetSesionStorage(l){console.log(l),sessionStorage.removeItem("user");let a={id:l._id,ok:!0,usuario:l};sessionStorage.setItem("user",JSON.stringify(a)),this.user=p(this,r).currentUserExists().usuario}};r=new WeakMap,o=new WeakMap,S=new WeakMap,f=new WeakMap,s.\u0275fac=function(a){return new(a||s)},s.\u0275cmp=w({type:s,selectors:[["app-user-detail"]],standalone:!0,features:[E],decls:38,vars:8,consts:[["ElseImage",""],[1,"container-fluid"],[1,"row"],[1,"col-12"],[1,"d-flex","justify-content-between","mb-5"],[1,"btn","btn-outline-warning"],[1,"col-12","col-lg-9"],[3,"ngSubmit","formGroup"],[1,"form-group","mb-3"],["for","user"],["type","text","id","user","placeholder","Nombre","formControlName","name",1,"form-control"],["for","password"],["type","password","id","password","placeholder","******","formControlName","password",1,"form-control"],["for","password2"],["type","password","id","password2","placeholder","******","formControlName","password2",1,"form-control"],["class","form-group mb-3",4,"ngIf"],[1,"form-group","mb-3","d-flex","justify-content-between"],["type","submit",1,"btn","btn-success"],["for","file",1,"btn","btn-primary","my-2"],[1,"col-12","col-lg-3"],["type","file","name","file","id","file",1,"d-none",3,"change"],[4,"ngIf","ngIfElse"],[1,"mt-2","text-center"],["for","email"],["type","email","id","email","placeholder","******","formControlName","email",1,"form-control"],["for","role"],["name","role","id","role","formControlName","role",1,"form-control"],["value",""],["value","ADMIN_ROLE"],["value","USER_ROLE"],["type","usuario",3,"imagen"],["for","file",1,"btn","btn-primary"]],template:function(a,m){if(a&1){let b=D();t(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"h2"),n(5,"Editar Usuario"),e(),t(6,"button",5),n(7,"Listado de Usuarios"),e()()(),t(8,"div",6)(9,"form",7),x("ngSubmit",function(){return I(b),_(m.saved())}),t(10,"div",8)(11,"label",9),n(12,"Nombre"),e(),c(13,"input",10),e(),t(14,"div",8)(15,"label",11),n(16,"Contrase\xF1a"),e(),c(17,"input",12),e(),t(18,"div",8)(19,"label",13),n(20,"Repetir Contrase\xF1a"),e(),c(21,"input",14),e(),C(22,re,4,0,"div",15)(23,ne,10,0,"div",15),t(24,"div",16)(25,"button",17),n(26,"Enviar"),e(),t(27,"label",18),n(28," Cambiar Inagen "),e()()()(),t(29,"div",19)(30,"input",20),x("change",function(te){return I(b),_(m.cambiarImagen(te))}),e(),C(31,oe,2,1,"div",21)(32,ae,2,0,"ng-template",null,0,O),t(34,"h6",22)(35,"strong"),n(36),M(37,"uppercase"),e()()()()()}if(a&2){let b=F(33);u(9),d("formGroup",m.formUser),u(13),d("ngIf",m.user.role==="ADMIN_ROLE"),u(),d("ngIf",m.user.role==="ADMIN_ROLE"),u(8),d("ngIf",m.user.img!=="")("ngIfElse",b),u(5),T(A(37,6,m.user.name))}},dependencies:[Z,k,X,z,K,Q,G,H,q,B,J,P,L],encapsulation:2});let i=s;return i})();var se=[{path:"",title:"Usuarios",data:{title:"Mi perfil",background:"bg-primary"},loadComponent:()=>$}],Ce=se;export{Ce as default};
